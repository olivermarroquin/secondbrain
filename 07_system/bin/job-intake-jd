#!/usr/bin/env bash
set -euo pipefail

usage() {
  echo 'usage: job-intake-jd --app "/abs/or/~/path/to/application-folder"' >&2
  exit 2
}

APP=""
while [[ $# -gt 0 ]]; do
  case "$1" in
    --app) APP="${2:-}"; shift 2 ;;
    -h|--help) usage ;;
    *) echo "unknown arg: $1" >&2; usage ;;
  esac
done

[[ -z "$APP" ]] && usage
APP="${APP/#\~/$HOME}"

JD="$APP/jd/jd-raw.txt"
[[ -d "$APP/jd" ]] || { echo "ERROR: missing $APP/jd" >&2; exit 2; }

echo "Paste JD now. Finish with Ctrl+D."
cat > "$JD"

LINES="$(wc -l < "$JD" | tr -d ' ')"
if [[ "$LINES" -eq 0 ]]; then
  echo "ERROR: jd-raw.txt is empty. Paste failed." >&2
  exit 2
fi

echo
echo "Captured $LINES lines:"
sed -n '1,5p' "$JD"
echo "..."
sed -n '$p' "$JD"
